<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dishcovery Dashboard</title>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    /* ────────────────────── GLOBAL ────────────────────── */
    *{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
    body{background:#f9f9f9;color:#333;overflow-x:hidden;}
    .container{display:flex;min-height:100vh;position:relative;}

    /* ────────────────────── SIDEBAR ────────────────────── */
    .sidebar{
      width:240px;background:#fff;border-right:1px solid #eee;padding:1rem;
      display:flex;flex-direction:column;position:fixed;left:0;top:0;bottom:0;
      z-index:20;transition:transform .4s;transform:translateX(-100%);
    }
    .sidebar.active{transform:translateX(0);}
    .sidebar .logo img{width:140px;}
    .menu{display:flex;flex-direction:column;gap:.5rem;margin-top:2rem;}
    .menu a{text-decoration:none;color:#555;padding:.8rem 1rem;border-radius:8px;
            display:flex;align-items:center;gap:.7rem;font-size:.95rem;transition:.3s;}
    .menu a i{width:20px;color:#f44336;}
    .menu a:hover,.menu a.active{background:#f44336;color:#fff;}
    .menu a:hover i,.menu a.active i{color:#fff;}

    /* ────────────────────── OVERLAY & MAIN ────────────────────── */
    .overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:15;opacity:0;transition:opacity .3s;}
    .overlay.active{display:block;opacity:1;}
    .main{flex:1;padding:2rem;width:100%;transition:padding-left .4s;}

    /* ────────────────────── TOPBAR ────────────────────── */
    .topbar{
      display:flex;flex-direction:column;align-items:center;gap:1rem;
      margin-bottom:2rem;border-bottom:1px solid #eee;padding-bottom:1rem;
      position:relative;
    }
    .toggle-sidebar{
      background:#f44336;color:#fff;border:none;padding:.6rem 1rem;
      border-radius:6px;cursor:pointer;font-size:1.2rem;
      position:absolute;left:0;top:0;transform:translateY(-50%);
      display:block;               /* always visible */
    }
    .filters{display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center;width:100%;}
    .filters button{background:#fff;border:1px solid #f44336;border-radius:10px;
                    padding:.5rem 1rem;cursor:pointer;transition:.3s;font-size:.9rem;}
    .filters button.active,.filters button:hover{background:#f44336;color:#fff;border-color:#f44336;}
    #searchPage .filters{display:none;}

    /* ────────────────────── ADMIN DASHBOARD LINK ────────────────────── */
    .admin-dashboard-link {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #d84444;
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      font-weight: 500;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }
    .admin-dashboard-link:hover {
      background: #c13c3c;
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .admin-dashboard-link i {
      font-size: 16px;
    }

    /* ────────────────────── RECIPE CARD ────────────────────── */
    .recipe-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1.5rem;}
    .recipe-card{background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.1);
                transition:transform .2s;cursor:pointer;position:relative;}
    .recipe-card:hover{transform:translateY(-5px);}
    .recipe-card img{width:100%;height:180px;object-fit:cover;}
    .recipe-info{padding:1rem;}
    .tag{background:#f44336;color:#fff;font-size:.8rem;padding:3px 10px;border-radius:12px;display:inline-block;margin-bottom:.5rem;}
    .recipe-info h3{margin-top:.5rem;font-size:1.1rem;font-weight:600;}
    .meta{color:#777;font-size:.9rem;margin:.4rem 0;}
    .desc{font-size:.9rem;color:#555;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;}
    .save-btn{position:absolute;top:10px;right:10px;background:rgba(255,255,255,.9);border:none;
              border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;
              cursor:pointer;transition:.3s;font-size:1.2rem;color:#777;z-index:10;}
    .save-btn:hover{background:#fff;transform:scale(1.1);}
    .save-btn.saved{color:#f44336;}
    .save-btn.saved i{animation:bounce .5s;}
    @keyframes bounce{0%,100%{transform:scale(1)}50%{transform:scale(1.3)}}

    /* ────────────────────── SEARCH PAGE ────────────────────── */
    .search-area{position:relative;width:100%;display:flex;align-items:center;justify-content:flex-start;}
    .search-area input{width:70%;max-width:600px;padding:.9rem 1rem .9rem 3rem;border:1px solid #ccc;
                       border-radius:50px;outline:none;font-size:1rem;box-shadow:0 1px 4px rgba(0,0,0,.05);}
    .search-area i{position:absolute;left:18px;color:#999;font-size:1.2rem;}
    .search-section-header{font-size:1.25rem;color:#333;margin-bottom:1rem;font-weight:600;}
    .recent-searches,.popular-searches{margin-top:2rem;}
    .recent-searches-list{display:flex;gap:.5rem;flex-wrap:wrap;}
    .recent-search-tag{background:#fff;border:1px solid #ddd;border-radius:6px;padding:.5rem 1rem;
                       cursor:pointer;transition:.3s;font-size:.9rem;color:#555;display:flex;align-items:center;gap:.5rem;}
    .recent-search-tag i{color:#f44336;font-size:.9rem;}
    .recent-search-tag:hover{background:#f4f4f4;}

    /* ────────────────────── MY RECIPES ────────────────────── */
    .my-recipes-stats{display:flex;gap:2rem;margin-bottom:2rem;}
    .stat-card{background:#fff;padding:1.5rem;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.1);
               text-align:center;flex:1;}
    .stat-number{font-size:2rem;font-weight:bold;color:#f44336;display:block;}
    .stat-label{color:#777;font-size:.9rem;}
    .empty-state{text-align:center;padding:3rem;color:#777;grid-column:1/-1;}
    .empty-state i{font-size:4rem;color:#ddd;margin-bottom:1rem;}

    /* ────────────────────── RECIPE DETAIL ────────────────────── */
    .recipe-detail{padding:1rem;max-width:1200px;margin:0 auto;}
    .back-btn{background:none;border:none;color:#f44336;font-size:1rem;cursor:pointer;
             margin-bottom:1rem;display:flex;align-items:center;gap:.5rem;padding:.5rem 0;}
    .back-btn:hover{color:#d32f2f;}
    .recipe-detail-content{background:#fff;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.1);overflow:hidden;}
    .image-container{position:relative;width:100%;}
    .detail-img{width:100%;height:400px;object-fit:cover;}
    .image-dots{position:absolute;bottom:15px;left:50%;transform:translateX(-50%);
                display:flex;gap:8px;}
    .image-dots .dot{width:8px;height:8px;background:#fff;border-radius:50%;opacity:.5;transition:.3s;}
    .image-dots .dot.active{opacity:1;background:#f44336;}
    .recipe-text{padding:1.5rem;}
    .recipe-text .tag{background:#f44336;color:#fff;font-size:.8rem;padding:4px 12px;border-radius:12px;margin-bottom:1rem;display:inline-block;}
    .recipe-text h2{color:#333;font-size:1.8rem;margin-bottom:1rem;font-weight:600;}
    .rating-info{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;}
    .star-rating{display:flex;gap:2px;}
    .star-rating i{color:gold;font-size:1.1rem;}
    .rating-value{color:#333;font-weight:600;}
    .rating-count{color:#777;font-size:.9rem;}
    .recipe-meta-data{display:flex;gap:1.5rem;margin-bottom:1.5rem;flex-wrap:wrap;}
    .recipe-meta-data p{display:flex;align-items:center;gap:.5rem;color:#555;font-size:.95rem;}
    .recipe-meta-data i{color:#f44336;width:16px;}
    .description-text{color:#555;line-height:1.6;margin-bottom:1.5rem;font-size:1rem;}
    .nutrition-card{background:#f8f9fa;padding:1.5rem;border-radius:8px;margin-top:1.5rem;}
    .nutrition-card h3{color:#333;margin-bottom:1rem;font-size:1.2rem;font-weight:600;}
    .nutrition-details p{display:flex;justify-content:space-between;padding:.5rem 0;
                        border-bottom:1px solid #e9ecef;color:#555;}
    .nutrition-details p:last-child{border-bottom:none;}
    .nutrition-details span{font-weight:600;color:#333;}
    .detail-main-section{padding:1.5rem;border-top:1px solid #eee;}
    .detail-main-section h3{color:#333;font-size:1.3rem;margin-bottom:1rem;font-weight:600;}
    #detailIngredients{list-style:none;padding:0;margin-bottom:2rem;}
    .ingredient-item{display:flex;justify-content:space-between;align-items:center;
                     padding:.8rem 0;border-bottom:1px solid #f0f0f0;}
    .ingredient-item:last-child{border-bottom:none;}
    .ingredient-name{display:flex;align-items:center;gap:.8rem;color:#333;flex:1;}
    .ingredient-name input[type=checkbox]{width:18px;height:18px;border:2px solid #ddd;
                                         border-radius:4px;cursor:pointer;}
    .ingredient-name input[type=checkbox]:checked{background:#f44336;border-color:#f44336;}
    .ingredient-item span{color:#666;font-weight:500;min-width:80px;text-align:right;}
    #detailInstructions{list-style:none;padding:0;}
    .instruction-item{padding:1rem 0;border-bottom:1px solid #f0f0f0;}
    .instruction-item:last-child{border-bottom:none;}
    .instruction-item p{display:flex;align-items:flex-start;gap:1rem;color:#333;
                        line-height:1.6;margin:0;}
    .instruction-number{background:#f44336;color:#fff;border-radius:50%;width:24px;height:24px;
                        display:flex;align-items:center;justify-content:center;font-size:.9rem;
                        font-weight:600;flex-shrink:0;margin-top:2px;}
    .you-might-like-section{padding:1.5rem;border-top:1px solid #eee;}
    .you-might-like-section h3{color:#333;font-size:1.3rem;margin-bottom:1rem;font-weight:600;}
    .you-might-like-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;}
    .recipe-text .save-btn{background:transparent;border:none;color:#777;font-size:1.2rem;
                           cursor:pointer;padding:.5rem;border-radius:50%;transition:.3s;}
    .recipe-text .save-btn:hover{background:rgba(244,67,54,.1);color:#f44336;}
    .recipe-text .save-btn.saved{color:#f44336;}

    .page{display:none;}
    .active-page{display:block;animation:fadeIn .3s;}
    @keyframes fadeIn{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}

    /* ────────────────────── RESPONSIVE ────────────────────── */
    @media (max-width:1024px){
      .main{padding-left:2rem;}
    }
    @media (max-width: 768px) {
      .admin-dashboard-link {
        top: 10px;
        right: 10px;
        padding: 8px 12px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
<div class="container">
  <!-- ====================== SIDEBAR ====================== -->
  <aside class="sidebar" id="sidebar">
    <div class="logo"><img src="../images/Frame 13.png" alt="Dishcovery Logo"></div>
    <nav class="menu">
      <a href="#" class="nav-link active" data-page="home"><i class="fa-solid fa-house"></i> Home</a>
      <a href="#" class="nav-link" data-page="search"><i class="fa-solid fa-magnifying-glass"></i> Search</a>
      <a href="../sign-up page/sign-up.html" class="nav-link" data-page="add-recipe"><i class="fa-solid fa-plus"></i> Add Recipe</a>
      <a href="#" class="nav-link" data-page="my-recipes"><i class="fa-solid fa-book"></i> My Recipes</a>
      <a href="#" class="nav-link" data-page="more"><i class="fa-solid fa-ellipsis"></i> More</a>
      <a href="../index.html">Go Back To home</a>
    </nav>
  </aside>

  <div class="overlay" id="overlay"></div>

  <!-- ====================== MAIN ====================== -->
  <main class="main">
    <!-- Admin Dashboard Link - Will be added dynamically if user is logged in -->
    <a href="../admin-dashboard/admin.html" class="admin-dashboard-link" id="adminDashboardLink" style="display: none;">
      <i class="fa-solid fa-chart-line"></i> Admin Dashboard
    </a>

    <header class="topbar">
      <button class="toggle-sidebar" id="toggleSidebar"><i class="fa-solid fa-bars"></i></button>
      <div class="filters">
        <button class="filter-btn active" data-filter="all">All</button>
        <button class="filter-btn" data-filter="breakfast">Breakfast</button>
        <button class="filter-btn" data-filter="lunch">Lunch</button>
        <button class="filter-btn" data-filter="dinner">Dinner</button>
        <button class="filter-btn" data-filter="snacks">Snacks</button>
        <button class="filter-btn" data-filter="drinks">Drinks</button>
      </div>
    </header>

    <!-- ====================== HOME ====================== -->
    <section id="homePage" class="page active-page">
      <section class="recipe-grid" id="homeRecipes"></section>
    </section>

    <!-- ====================== SEARCH ====================== -->
    <section id="searchPage" class="page">
      <div class="search-area">
        <input type="text" id="searchInput" placeholder="Search recipes, cuisine, or snacks..." />
        <i class="fa-solid fa-magnifying-glass"></i>
      </div>
      <hr style="margin:1.5rem 0;border:0;border-top:1px solid #eee;">
      <div class="recent-searches">
        <h2 class="search-section-header">Recent Searches</h2>
        <div class="recent-searches-list">
          <div class="recent-search-tag"><i class="fa-solid fa-drumstick-bite"></i> Chicken curry</div>
          <div class="recent-search-tag"><i class="fa-solid fa-bowl-food"></i> Pepper soup</div>
          <div class="recent-search-tag"><i class="fa-solid fa-pizza-slice"></i> Pepperoni pizza</div>
          <div class="recent-search-tag"><i class="fa-solid fa-bowl-rice"></i> Native rice</div>
          <div class="recent-search-tag"><i class="fa-solid fa-plate-wheat"></i> Indomie stir-fry</div>
        </div>
      </div>
      <div class="popular-searches">
        <h2 class="search-section-header">Popular Searches</h2>
        <section class="recipe-grid" id="searchResults"></section>
      </div>
    </section>

    <!-- ====================== MY RECIPES ====================== -->
    <section id="myRecipesPage" class="page">
      <div class="my-recipes-header"><h2>My Saved Recipes</h2></div>
      <div class="my-recipes-stats">
        <div class="stat-card"><span class="stat-number" id="totalSaved">0</span><span class="stat-label">Total Saved</span></div>
        <div class="stat-card"><span class="stat-number" id="breakfastCount">0</span><span class="stat-label">Breakfast</span></div>
        <div class="stat-card"><span class="stat-number" id="lunchCount">0</span><span class="stat-label">Lunch</span></div>
        <div class="stat-card"><span class="stat-number" id="dinnerCount">0</span><span class="stat-label">Dinner</span></div>
      </div>
      <section class="recipe-grid" id="savedRecipes">
        <div class="empty-state" id="emptySavedRecipes">
          <i class="far fa-bookmark"></i>
          <h3>No Saved Recipes Yet</h3>
          <p>Start saving your favorite recipes by clicking the bookmark icon!</p>
        </div>
      </section>
    </section>

    <!-- ====================== RECIPE DETAIL ====================== -->
    <section id="recipeDetailPage" class="page recipe-detail">
      <p style="text-align:center;color:#777;margin-top:30px;">Click a recipe card to view details.</p>
    </section>
  </main>
</div>

<script>
/* ============================== SIMPLE AUTHENTICATION CHECK ============================== */
function checkAuthentication() {
  // SIMPLE CHECK: If authToken exists, show admin dashboard link
  const token = localStorage.getItem('authToken');
  const userData = localStorage.getItem('userData');
  
  console.log('Auth check - Token:', token, 'UserData:', userData);
  
  if (token) {
    // User has logged in before, show admin dashboard link
    document.getElementById('adminDashboardLink').style.display = 'flex';
    console.log('✅ Showing admin dashboard link - user is logged in');
  } else {
    // User is not logged in, hide admin dashboard link
    document.getElementById('adminDashboardLink').style.display = 'none';
    console.log('❌ Hiding admin dashboard link - user is not logged in');
  }
}

/* ============================== ADMIN DASHBOARD LINK PROTECTION ============================== */
function protectAdminDashboardLink() {
  const adminLink = document.getElementById('adminDashboardLink');
  if (adminLink) {
    adminLink.addEventListener('click', function(e) {
      const token = localStorage.getItem('authToken');
      
      if (!token) {
        // User is not logged in, prevent access and redirect to login
        e.preventDefault();
        alert('Please login to access the admin dashboard');
        window.location.href = "../login-active_folder/login-active.html";
        return;
      }
      
      // User has authToken, allow navigation to admin dashboard
      console.log('✅ Allowing access to admin dashboard');
    });
  }
}

/* ============================== DATA ============================== */
const STATIC_RECIPES = [
  {
    _id:1,
    name:"Pancakes",
    category:"breakfast",
    image:"https://images.pexels.com/photos/376464/pexels-photo-376464.jpeg?auto=compress&cs=tinysrgb&w=600",
    cookingTime:15,
    description:"Fluffy pancakes served warm with syrup and fresh berries — the perfect breakfast treat.",
    ingredients:[
      "1 ½ cups All-purpose flour",
      "3½ tsp Baking powder",
      "1 tsp Salt",
      "1 tbsp White sugar",
      "1¼ cups Milk",
      "1 large Egg",
      "3 tbsp Butter, melted",
      "1 tsp Vanilla extract",
      "Maple syrup (for serving) to taste"
    ],
    instructions:[
      "In a large bowl, stir together the flour, baking powder, salt and sugar. Make a hole in the center.",
      "Pour the milk, egg, melted butter, and vanilla extract into the well. Mix until smooth. The batter should be slightly lumpy.",
      "Heat a lightly oiled griddle or frying pan over medium-high heat.",
      "Pour or scoop the batter into the griddle, using approximately ¼ cup for each pancake.",
      "Cook until bubbles form on the surface and the edges look dry, about 2-3 minutes.",
      "Flip and cook until golden brown on the other side, about 2 minutes more.",
      "Serve hot with butter and maple syrup, or your favorite toppings."
    ]
  },
  {
    _id:2,
    name:"Jollof Rice",
    category:"lunch",
    image:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS2jT5vwT7cMO-MWPUx1Th6hNZH8N1wh5GzRQ&s",
    cookingTime:45,
    description:"A West African classic — spicy rice cooked with tomatoes, peppers, and seasoning.",
    ingredients:["2 cups rice","5 tomatoes","1 red bell pepper","1 onion","Seasoning cubes and salt"],
    instructions:["Blend tomatoes, pepper, and onion.","Cook sauce with oil and seasoning until thick.","Add rice and water, cover, and simmer until done."]
  },
  {
    _id:3,
    name:"Puff Puff",
    category:"snacks",
    image:"https://images.unsplash.com/photo-1664993085274-80c6ba725ccc?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8cHVmZiUyMHB1ZmZ8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&q=60&w=500",
    cookingTime:30,
    description:"Fluffy deep-fried dough balls — slightly sweet and addictive, perfect for snacks.",
    ingredients:["2 cups flour","½ cup sugar","2 tsp yeast","1 cup warm water","Oil for frying"],
    instructions:["Mix flour, sugar, yeast, and water into thick batter.","Allow to rise for 1 hour.","Fry in hot oil until golden brown."]
  },
  {
    _id:4,
    name:"Grilled Chicken",
    category:"dinner",
    image:"https://images.pexels.com/photos/2338407/pexels-photo-2338407.jpeg?auto=compress&cs=tinysrgb&w=600",
    cookingTime:35,
    description:"Juicy grilled chicken marinated in herbs and spices — smoky and delicious.",
    ingredients:["1 kg chicken","2 tbsp olive oil","1 tsp garlic powder","1 tsp paprika","Salt and pepper"],
    instructions:["Marinate chicken with oil and spices for 30 mins.","Grill on medium heat for 15-20 mins per side.","Serve hot."]
  },
  {
    _id:5,
    name:"Smoothie",
    category:"drinks",
    image:"https://images.pexels.com/photos/109275/pexels-photo-109275.jpeg?auto=compress&cs=tinysrgb&w=600",
    cookingTime:5,
    description:"A refreshing fruit smoothie packed with vitamins and a cool burst of energy.",
    ingredients:["1 banana","1 cup mixed berries","1 cup yogurt","½ cup milk","1 tbsp honey"],
    instructions:["Blend all ingredients until smooth.","Pour into a glass and enjoy!"]
  },
  {
    _id:6,
    name:"Avocado Toast",
    category:"breakfast",
    image:"https://www.eatingwell.com/thmb/PM3UlLhM0VbE6dcq9ZFwCnMyWHI=/1500x0/filters:no_upscale():max_bytes(150000):strip_icc()/EatingWell-April-Avocado-Toast-Directions-04-5b5b86524a3d4b35ac4c57863f6095dc.jpg",
    cookingTime:10,
    description:"Toasted bread topped with creamy avocado and seasonings — simple and satisfying.",
    ingredients:["2 slices bread","1 ripe avocado","Salt, pepper, chili flakes","Lemon juice"],
    instructions:["Toast bread.","Mash avocado with lemon, salt, pepper.","Spread on toast and sprinkle chili flakes."]
  },
  {
    _id:7,
    name:"Spaghetti Bolognese",
    category:"lunch",
    image:"https://images.pexels.com/photos/1279330/pexels-photo-1279330.jpeg?auto=compress&cs=tinysrgb&w=600",
    cookingTime:40,
    description:"Classic Italian pasta with rich tomato meat sauce — comforting and hearty.",
    ingredients:["300g spaghetti","500g minced beef","1 onion","2 garlic cloves","400g tomato sauce","Herbs"],
    instructions:["Cook pasta.","Brown beef with onion and garlic.","Add sauce and simmer 20 mins.","Serve over pasta."]
  },
  {
    _id:8,
    name:"Chicken Salad",
    category:"dinner",
    image:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT_0g5ye5m4y6OH0a-RZn6e06odvhLsKgneEQ&s",
    cookingTime:20,
    description:"Light and healthy — grilled chicken tossed with crisp vegetables and dressing.",
    ingredients:["2 chicken breasts","Lettuce","Tomato","Cucumber","Olive oil dressing"],
    instructions:["Grill chicken and slice.","Toss with veggies and dressing.","Serve fresh."]
  },
  {
    _id:9,
    name:"Fried Rice",
    category:"lunch",
    image: "https://images.unsplash.com/photo-1664717698774-84f62382613b?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NTR8fGZyaWVkJTIwcmljZXxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&q=60&w=500",
    cookingTime:35,
    description:"Colorful rice stir-fried with veggies and proteins — a Nigerian party favorite.",
    ingredients:["2 cups rice","Mixed veggies","Shrimp or chicken","Soy sauce","Seasoning"],
    instructions:["Cook rice and cool.","Stir-fry protein and veggies.","Add rice and soy sauce, mix well."]
  },
  {
    _id:10,
    name:"Chapman Drink",
    category:"drinks",
    image:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTTTTtw3YxLHmJjiXeRnGV_lY_KwsZwUXI8tA&s",
    cookingTime:5,
    description:"Popular Nigerian cocktail made with Fanta, Sprite, and bitters — sweet and zesty.",
    ingredients:["Fanta","Sprite","Angostura bitters","Grenadine","Orange slice"],
    instructions:["Mix equal parts Fanta and Sprite.","Add a dash of bitters and grenadine.","Garnish with orange."]
  },
  {
    _id:11,
    name:"Suya",
    category:"dinner",
    image:"https://cookingwithclaudy.com/wp-content/uploads/2024/05/FB_IMG_1714779479334.jpg",
    cookingTime:25,
    description:"Spicy Nigerian street food — grilled beef skewers coated with yaji pepper mix.",
    ingredients:["500g beef","Yaji spice","Onion","Skewers","Oil"],
    instructions:["Cut beef into strips.","Coat with yaji and oil.","Skewer and grill until charred."]
  },
  {
    _id:12,
    name:"Fruit Parfait",
    category:"drinks",
    image:"https://tatyanaseverydayfood.com/wp-content/uploads/2021/06/Easy-Fruit-Granola-Parfaits.jpg",
    cookingTime:10,
    description:"Layered yogurt, fruits, and granola — delicious and refreshing.",
    ingredients:["Greek yogurt","Mixed fruits","Granola","Honey"],
    instructions:["Layer yogurt, fruits, and granola in a glass.","Drizzle with honey.","Serve chilled."]
  }
];

// Load savedRecipes from localStorage and ensure IDs are numbers
let savedRecipes = JSON.parse(localStorage.getItem('savedRecipes')) || [];
savedRecipes = savedRecipes.map(id => Number(id)).filter(id => !Number.isNaN(id));

/* ============================== INTEGRATION WITH ADMIN DASHBOARD ============================== */
function loadRecipesFromAdminDashboard() {
  try {
    const adminRecipes = JSON.parse(localStorage.getItem('dishcovery_all_recipes')) || [];
    console.log('Recipes from admin dashboard:', adminRecipes);
    
    // Convert admin recipes to match our format
    const convertedRecipes = adminRecipes.map(recipe => {
      // Generate a unique ID for admin recipes (use negative numbers to avoid conflicts)
      const adminId = -Math.abs(parseInt(recipe.id) || Date.now());
      
      return {
        _id: adminId,
        name: recipe.name,
        category: recipe.category,
        image: recipe.image,
        cookingTime: parseInt(recipe.prepTime) || 30, // Convert "30 mins" to 30
        description: recipe.description,
        ingredients: ["Ingredients added via admin dashboard"], // Default ingredients
        instructions: ["Instructions added via admin dashboard"] // Default instructions
      };
    });
    
    return convertedRecipes;
  } catch (error) {
    console.error('Error loading recipes from admin dashboard:', error);
    return [];
  }
}

// Combine static recipes with admin dashboard recipes
function getAllRecipes() {
  const adminRecipes = loadRecipesFromAdminDashboard();
  const allRecipes = [...STATIC_RECIPES, ...adminRecipes];
  console.log('All recipes (static + admin):', allRecipes);
  return allRecipes;
}

let ALL_RECIPES = getAllRecipes();

/* ============================== SAVE LOGIC ============================== */
function toggleSaveRecipe(id){
  const idx = savedRecipes.indexOf(id);
  if (idx > -1) {
    // If already saved, remove it
    savedRecipes.splice(idx, 1);
  } else {
    // If not saved, add it
    savedRecipes.push(id);
  }

  // Save to localStorage
  localStorage.setItem('savedRecipes', JSON.stringify(savedRecipes));

  // Update buttons and the My Recipes page
  updateAllSaveButtons(id);
  updateMyRecipesPage();
}

function updateAllSaveButtons(id) {
  // Update all save buttons anywhere in the page
  document.querySelectorAll(`.save-btn`).forEach(btn => {
    // Check if this button belongs to the recipe
    const parentCard = btn.closest('.recipe-card');
    const btnId = parentCard ? Number(parentCard.dataset.recipeId) : Number(btn.dataset.recipeId);
    if (btnId === id) {
      const saved = savedRecipes.includes(id);
      btn.classList.toggle('saved', saved);
      btn.innerHTML = `<i class="${saved ? 'fas' : 'far'} fa-bookmark"></i>`;
    }
  });
}

/* ============================== CARD ============================== */
function createRecipeCard(r){
  const card = document.createElement('div');
  card.className = 'recipe-card';
  card.dataset.recipeId = r._id;
  const saved = savedRecipes.includes(r._id);

  // Use span for tag to avoid nested button markup issues
  card.innerHTML = `
    <button class="save-btn ${saved ? 'saved' : ''}" onclick="event.stopPropagation();toggleSaveRecipe(${r._id})">
      <i class="${saved ? 'fas' : 'far'} fa-bookmark"></i>
    </button>

    <img src="${r.image}" alt="${r.name}">
    <div class="recipe-info">
      <span class="tag">${r.category.charAt(0).toUpperCase() + r.category.slice(1)}</span>
      <h3>${r.name}</h3>
      <p class="meta"><i class="fa-regular fa-clock"></i> ${r.cookingTime} mins</p>
      <p class="desc">${r.description}</p>
    </div>`;

  card.addEventListener('click', () => showRecipeDetail(r));
  return card;
}

/* ============================== RENDER ============================== */
function renderRecipes(list, container){
  container.innerHTML='';
  list.forEach(r=>container.appendChild(createRecipeCard(r)));
  if(!list.length) container.innerHTML='<p style="text-align:center;color:#777;margin-top:30px;grid-column:1/-1;">No recipes found.</p>';
}

/* ============================== DETAIL PAGE ============================== */
function showRecipeDetail(recipe){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active-page'));
  document.getElementById('recipeDetailPage').classList.add('active-page');

  const prepTime=5, cookTime=15, rating=5.0, reviews=234;
  const nutrition={Calories:"227",Protein:"6g",Carbs:"28g",Fat:"9g",Fiber:"1g",Sugar:"7g"};

  const ingredientsHTML = recipe.ingredients.map(i=>{
    const [amount,...rest] = i.split(/,\s*/);
    const name = rest.join(', ') || amount;
    return `<li class="ingredient-item">
              <label class="ingredient-name"><input type="checkbox">${name}</label>
              <span>${amount}</span>
            </li>`;
  }).join('');

  const instructionsHTML = recipe.instructions.map((s,i)=>`
    <li class="instruction-item">
      <p><span class="instruction-number">${i+1}</span>${s}</p>
    </li>`).join('');

  const mightLike = ALL_RECIPES.filter(r=>r._id!==recipe._id).slice(0,2);

  // ---- BUILD THE WHOLE DETAIL PAGE ----
  document.getElementById('recipeDetailPage').innerHTML = `
    <button class="back-btn">Back to Dashboard</button>
    <div class="recipe-detail-content">
      <div class="image-container">
        <img src="${recipe.image}" alt="${recipe.name}" class="detail-img">
        <div class="image-dots"><span class="dot active"></span><span class="dot"></span><span class="dot"></span></div>
      </div>

      <div class="recipe-text">
        <button class="tag">${recipe.category.charAt(0).toUpperCase()+recipe.category.slice(1)}</button>
        <h2>${recipe.name}</h2>
        <div class="rating-info">
          <div class="star-rating">${Array(5).fill('<i class="fa-solid fa-star"></i>').join('')}</div>
          <p class="rating-value">${rating} <span class="rating-count">(${reviews} reviews)</span></p>
          <button class="save-btn ${savedRecipes.includes(recipe._id)?'saved':''}" 
        data-recipe-id="${recipe._id}" 
        onclick="event.stopPropagation(); toggleSaveRecipe(${recipe._id})">
  <i class="${savedRecipes.includes(recipe._id)?'fas':'far'} fa-bookmark"></i>
</button>
        </div>
        <div class="recipe-meta-data">
          <p><i class="fa-regular fa-clock"></i> Prep Time: <span>${prepTime} mins</span></p>
          <p><i class="fa-solid fa-fire-burner"></i> Cook Time: <span>${cookTime} mins</span></p>
          <p><i class="fa-solid fa-user-group"></i> Servings: <span>4</span></p>
        </div>
        <p class="description-text">${recipe.description}</p>

        <div class="nutrition-card">
          <h3>Nutrition Information</h3>
          <div class="nutrition-details">
            <p>Calories <span>${nutrition.Calories}</span></p>
            <p>Protein <span>${nutrition.Protein}</span></p>
            <p>Carbs <span>${nutrition.Carbs}</span></p>
            <p>Fat <span>${nutrition.Fat}</span></p>
            <p>Fiber <span>${nutrition.Fiber}</span></p>
            <p>Sugar <span>${nutrition.Sugar}</span></p>
          </div>
        </div>
      </div>

      <div class="detail-main-section">
        <h3>Ingredients</h3>
        <ul id="detailIngredients">${ingredientsHTML}</ul>
        <h3>Instructions</h3>
        <ul id="detailInstructions">${instructionsHTML}</ul>
      </div>

      <div class="you-might-like-section">
        <h3 class="you-might-like">You Might Also Like</h3>
        <div class="recipe-grid you-might-like-grid" id="mightLikeGrid"></div>
      </div>
    </div>`;

  // ---- BACK BUTTON ----
  document.querySelector('.back-btn').addEventListener('click',()=>{
    document.getElementById('recipeDetailPage').classList.remove('active-page');
    const active = document.querySelector('.nav-link.active');
    document.getElementById((active?active.dataset.page:'home')+'Page').classList.add('active-page');
  });

  // ---- POPULATE "You Might Also Like" ----
  const grid = document.getElementById('mightLikeGrid');
  grid.innerHTML = '';                     // clear any old cards
  mightLike.forEach(r => {
    const card = createRecipeCard(r);      // reuse the normal card function
    card.style.cursor = 'pointer';
    card.querySelector('.save-btn')?.remove();   // hide save button in suggestions
    card.addEventListener('click', (e) => {
      e.stopPropagation();
      showRecipeDetail(r);                 // **CLICK → open its detail page**
    });
    grid.appendChild(card);
  });
}

/* ============================== SEARCH FUNCTION ============================== */
const searchInput = document.getElementById('searchInput');
const searchResultsContainer = document.getElementById('searchResults');

searchInput.addEventListener('input', e => {
  const query = e.target.value.trim().toLowerCase();

  if (query === '') {
    // If input is empty → clear the results
    searchResultsContainer.innerHTML = '';
    return;
  }

  // Filter recipes by name, description, or category
  const results = ALL_RECIPES.filter(r =>
    r.name.toLowerCase().includes(query) ||
    r.description.toLowerCase().includes(query) ||
    r.category.toLowerCase().includes(query)
  );

  // Render search results dynamically
  renderRecipes(results, searchResultsContainer);
});

/* ============================== MY RECIPES ============================== */
function updateMyRecipesPage(){
  const saved = ALL_RECIPES.filter(r => savedRecipes.includes(r._id));

  // Update stats
  document.getElementById('totalSaved').textContent = saved.length;
  document.getElementById('breakfastCount').textContent = saved.filter(r => r.category === 'breakfast').length;
  document.getElementById('lunchCount').textContent = saved.filter(r => r.category === 'lunch').length;
  document.getElementById('dinnerCount').textContent = saved.filter(r => r.category === 'dinner').length;

  // Render saved recipes
  const container = document.getElementById('savedRecipes');
  if (!saved.length) {
    container.innerHTML = `
      <div class="empty-state">
        <i class="far fa-bookmark"></i>
        <h3>No Saved Recipes Yet</h3>
        <p>Start saving your favorite recipes by clicking the bookmark icon!</p>
      </div>`;
  } else {
    container.innerHTML = '';
    saved.forEach(r => container.appendChild(createRecipeCard(r)));
  }
}

/* ============================== SIDEBAR TOGGLE ============================== */
document.getElementById('toggleSidebar').addEventListener('click', () => {
  const sidebar = document.getElementById('sidebar');
  const overlay = document.getElementById('overlay');
  sidebar.classList.toggle('active');
  overlay.classList.toggle('active');
});
document.getElementById('overlay').addEventListener('click', () => {
  document.getElementById('sidebar').classList.remove('active');
  document.getElementById('overlay').classList.remove('active');
});

/* ============================== FILTER BUTTONS ============================== */
const filterButtons = document.querySelectorAll('.filter-btn');

filterButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    // Remove 'active' class from all buttons
    filterButtons.forEach(b => b.classList.remove('active'));
    // Add 'active' to the clicked one
    btn.classList.add('active');

    // Get category
    const filter = btn.dataset.filter;

    // Filter recipes
    let filtered = [];
    if (filter === 'all') {
      filtered = ALL_RECIPES;
    } else {
      filtered = ALL_RECIPES.filter(r => r.category === filter);
    }

    // Render filtered recipes to home grid
    renderRecipes(filtered, document.getElementById('homeRecipes'));
  });
});

/* ============================== PAGE NAVIGATION ============================== */
const navLinks = document.querySelectorAll('.nav-link');

navLinks.forEach(link => {
  link.addEventListener('click', e => {
    const targetPage = link.dataset.page;

    // ✅ If the link is "Add Recipe", allow it to go to the admin page normally
    if (targetPage === 'add-recipe') {
      return; // don't stop it — let it open the admin page
    }

    // For all other links, prevent the normal page refresh
    e.preventDefault();

    // update active link styles
    navLinks.forEach(l => l.classList.remove('active'));
    link.classList.add('active');

    // show the clicked page
    document.querySelectorAll('.page').forEach(page => page.classList.remove('active-page'));
    document.getElementById(targetPage + 'Page').classList.add('active-page');
  });
});

/* ============================== REFRESH RECIPES FUNCTION ============================== */
function refreshRecipes() {
  ALL_RECIPES = getAllRecipes();
  renderRecipes(ALL_RECIPES, document.getElementById('homeRecipes'));
  updateMyRecipesPage();
  console.log('Recipes refreshed:', ALL_RECIPES);
}

/* ============================== INITIAL LOAD ============================== */
// Check authentication on page load
checkAuthentication();
// Protect admin dashboard link
protectAdminDashboardLink();
refreshRecipes();

/* ============================== AUTO-REFRESH WHEN RETURNING TO PAGE ============================== */
// Refresh recipes when the page becomes visible (user returns from admin dashboard)
document.addEventListener('visibilitychange', function() {
  if (!document.hidden) {
    refreshRecipes();
    checkAuthentication(); // Also check authentication status
  }
});

// Also refresh when the page loads
window.addEventListener('load', function() {
  refreshRecipes();
  checkAuthentication();
  protectAdminDashboardLink();
});

// Check authentication periodically (every 2 seconds) to catch login/logout changes
setInterval(checkAuthentication, 2000);
</script>
</body>
</html>